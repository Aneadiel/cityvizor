<h2>Import účetních dat</h2>

<div class="panel panel-default">
	<div class="panel-heading">
		<strong>Import - Výdaje</strong>
	</div>
	<div class="panel-body">
		<div class="form-group">
			<label for="obec" class="col-sm-3 control-label">Datum platnosti</label>
			<div class="col-sm-9">
				<input type="date" class="form-control" id="date" [value]="" aria-describedby="help-entity">
				<span id="help-entity" class="help-block">Datum exportu dat z účetního systému.</span>
			</div>
		</div>
		<div class="form-group">
			<label for="obec" class="col-sm-3 control-label">Rozpočtový rok</label>
			<div class="col-sm-9">
				<input type="date" class="form-control" name="year" type="number" [(ngModel)]="year" min="0" step="1">
				<span id="help-entity" class="help-block">Rok, ke kterému se data vztahují.</span>
			</div>
		</div>
		<div class="form-group">
			<label for="obec" class="col-sm-3 control-label">Soubor s daty</label>
			<div class="col-sm-9">
				<input name="file" type="file" ng2FileSelect [uploader]="expendituresUploader" accept=".csv,text/csv">
				<span id="help-entity" class="help-block">Formát dat: .CSV</span>
			</div>
		</div>
		<div class="form-group">
			<div class="col-sm-offset-3 col-sm-9">
				<button type="button" class="btn btn-default" (click)="uploadExpenditures()">Nahrát</button>
			</div>
		</div>
	</div>
</div>

<div class="panel panel-default">
	<div class="panel-heading">
		<strong>Import - Investiční akce</strong>
	</div>
	<div class="panel-body">
		<div class="form-group">
			<label for="obec" class="col-sm-3 control-label">Datum platnosti</label>
			<div class="col-sm-9">
				<input type="date" class="form-control" id="date" [value]="" aria-describedby="help-entity">
				<span id="help-entity" class="help-block">Datum exportu dat z účetního systému.</span>
			</div>
		</div>
		<div class="form-group">
			<label for="obec" class="col-sm-3 control-label">Rozpočtový rok</label>
			<div class="col-sm-9">
				<input type="date" class="form-control" name="year" type="number" [(ngModel)]="year" min="0" step="1">
				<span id="help-entity" class="help-block">Rok, ke kterému se data vztahují.</span>
			</div>
		</div>
		<div class="form-group">
			<label for="obec" class="col-sm-3 control-label">Soubor s daty</label>
			<div class="col-sm-9">
				<input name="file" type="file" ng2FileSelect [uploader]="eventsUploader" accept=".csv,text/csv">
				<span id="help-entity" class="help-block">Formát dat: .CSV</span>
			</div>
		</div>
		<div class="form-group">
			<div class="col-sm-offset-3 col-sm-9">
				<button type="button" class="btn btn-default" (click)="uploadEvents()">Nahrát</button>
			</div>
		</div>
	</div>
</div>

<h3>Historie</h3>

<div class="btn-group">
	<a (click)="loadHistory(etls.page - 1)" [class.disabled]="etls.page<=1" aria-label="Předchozí" class="btn btn-default"><span aria-hidden="true">&laquo;</span></a>
	<a (click)="loadETLs()" class="btn btn-default">Obnovit</a>
	<a (click)="loadHistory(etls.page + 1)" [class.disabled]="etls.page>=etls.pages" aria-label="Další" class="btn btn-default"><span aria-hidden="true">&raquo;</span></a>
</div>

<table class="table table-responsive table-condensed table-hover table-striped etls">
	<thead>
		<tr>
			<th>Datum</th>
			<th>Cíl</th>
			<th>Rok</th>
			<th>Soubor</th>
			<th>Stav</th>
			<th></th>
		</tr>
	</thead>
	<tbody>
		<ng-container *ngFor="let etl of etls.docs">
			<tr (click)="toggleETLVisible(etl)" class="header">
				<td>{{etl.date | date:"d. M. y H:mm:ss"}}</td>
				<td>{{targets[etl.target]}}</td>
				<td>{{etl.year}}</td>
				<td>{{etl.file}}</td>
				<td>{{statuses[etl.status]}}</td>
				<td><span *ngIf="etl.warnings.length">{{etl.warnings.length}} varování!</span></td>
			</tr>
			<tr>
				<td colspan="7" class="details">
					<div [class.visible]="etlVisible === etl._id">
						<dl>
							<dt>Nahrál uživatel</dt>
							<dd [title]="'Organizace: ' + etl.user?.organization + ', ID: ' + etl.user?._id">{{etl.user?.name}}</dd>
							
							<dt>Výsledek</dt>
							<dd>{{etl.result || etl.error}}</dd>

							<ng-container *ngIf="etl.warnings.length">
								<dt>Varování</dt>
								<dd>
									<ul>
										<li *ngFor="let warning of etl.warnings">{{warning}}</li>
									</ul>
								</dd>
							</ng-container>

						</dl>
					</div>
				</td>
			</tr>
		</ng-container>
</table>

