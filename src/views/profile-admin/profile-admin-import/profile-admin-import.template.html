<h2>Import účetních dat</h2>

<div class="boxes">
	<profile-admin-import-box *ngFor="let budget of budgets" [profile]="profile" [budget]="budget" (saved)="savedBudget($event)"></profile-admin-import-box>
</div>

<a (click)="createBudget()">Přidat rozpočtový rok</a>	

<div bsModal #importModal="bs-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
	<div class="modal-dialog modal-lg">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" (click)="importModal.hide()" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
				<h4 class="modal-title">Výsledek importu</h4>
			</div>
			<div *ngIf="importResult" class="modal-body">
				<p *ngIf="!importResult.warnings">Import dat proběhl v pořádku.</p>
				<p *ngIf="importResult.warnings">Import dat proběhl v pořádku s {{importResult.warnings.length}} varováními:</p>
				
				<ul>
					<li *ngFor="let warning of importResult.warnings">{{warning}}</li>
				</ul>
				
			</div>
		</div>
	</div>
</div>

<div class="hidden">
	<h3>Historie</h3>

	<table class="table table-responsive table-condensed table-hover table-striped etls">
		<thead>
			<tr>
				<th><!-- icon status --></th>
				<th>Datum</th>
				<th>Cíl</th>
				<th>Soubor</th>
				<th>Uživatel</th>
				<th><!-- icon warnings --></th>
				<th><!-- icon note --></th>
			</tr>
		</thead>
		<tbody>
			<ng-container *ngFor="let etl of etls.docs">
				<tr (click)="toggleETLVisible(etl)" class="header" [class.open]="etlVisible === etl._id">
					<td>
						<span *ngIf="etl.status == 'success'" title="Import proběhl úspěšně" class="note text-success"><i class="fa fa-check-circle" aria-hidden="true"></i></span>
						<span *ngIf="etl.status == 'error'" title="Nastala chyba. Data nebyla nahrána." class="note text-danger"><i class="fa fa-times-circle" aria-hidden="true"></i></span>
					</td>
					<td>{{etl.date | date:"d. M. y"}}</td>
					<td>{{targets[etl.target]}} {{etl.year}}</td>
					<td>{{etl.file}}</td>
					<td><span [title]="'Organizace: ' + etl.user?.organization + ', ID: ' + etl.user?._id" class="note">{{etl.user?.name}}</span></td>
					<td><span *ngIf="etl.warnings.length" [title]="etl.warnings.length + ' varování!'" class="note text-warning"><i class="fa fa-exclamation-triangle" aria-hidden="true"></i><sup>{{etl.warnings.length}}</sup></span></td>
					<td><span *ngIf="etl.note" [title]="etl.note" class="note text-info"><i class="fa fa-comment" aria-hidden="true"></i></span></td>
				</tr>
				<tr>
					<td colspan="7" class="details">
						<div [class.open]="etlVisible === etl._id">
							<dl>
								<dt>Výsledek</dt>
								<dd>{{etl.result || etl.error}}</dd>

								<ng-container *ngIf="etl.note">
									<dt>Poznámka</dt>
									<dd>{{etl.note}}</dd>
								</ng-container>

								<ng-container *ngIf="etl.warnings.length">
									<dt>Varování</dt>
									<dd>
										<ul>
											<li *ngFor="let warning of etl.warnings">{{warning}}</li>
										</ul>
									</dd>
								</ng-container>

							</dl>
						</div>
					</td>
				</tr>
			</ng-container>
	</table>

	<div class="btn-group">
		<a (click)="loadHistory(etls.page - 1)" [class.disabled]="etls.page<=1" aria-label="Předchozí" class="btn btn-default"><span aria-hidden="true">&laquo;</span></a>
		<a (click)="loadHistory(etls.page)" class="btn btn-default">Obnovit</a>
		<a (click)="loadHistory(etls.page + 1)" [class.disabled]="etls.page>=etls.pages" aria-label="Další" class="btn btn-default"><span aria-hidden="true">&raquo;</span></a>
	</div>

</div>