
<h2>Nahrát data</h2>
<h3>Výdaje</h3>


<div class="form-group">
	<div class="col-sm-12">
		
		Aktuální data k: {{latest.expenditures?.date | date:"d. M. y H:mm:ss"}}
		
		<input name="year" type="number" [(ngModel)]="year" min="0" step="1">
		
		<input name="file" type="file" ng2FileSelect [uploader]="expendituresUploader" accept=".csv,text/csv">
		
		<button type="button" (click)="uploadExpenditures()">Nahrát</button>
	</div>
</div>


<h3>Investiční akce</h3>

<div class="form-group">
	<div class="col-sm-12">
		
		Aktuální data k: {{latest.events?.date | date:"d. M. y H:mm:ss"}}
		
		<input name="year" type="number" [(ngModel)]="year">

		<input name="file" type="file" ng2FileSelect [uploader]="eventsUploader" accept=".csv,text/csv">
		
		<button type="button" (click)="uploadEvents()">Nahrát</button>
	</div>
</div>

<h2>Historie</h2>

<div class="btn-group">
	<a (click)="loadHistory(etls.page - 1)" [class.disabled]="etls.page<=1" aria-label="Předchozí" class="btn btn-default"><span aria-hidden="true">&laquo;</span></a>
	<a (click)="loadETLs()" class="btn btn-default">Obnovit</a>
	<a (click)="loadHistory(etls.page + 1)" [class.disabled]="etls.page>=etls.pages" aria-label="Další" class="btn btn-default"><span aria-hidden="true">&raquo;</span></a>
</div>

<table class="table table-condensed table-hover table-striped etls">
	<thead>
		<tr>
			<th>Datum</th>
			<th>Cíl</th>
			<th>Rok</th>
			<th>Soubor</th>
			<th>Stav</th>
			<th></th>
		</tr>
	</thead>
	<tbody>
		<ng-container *ngFor="let etl of etls.docs">
			<tr (click)="toggleETLVisible(etl)" class="header">
				<td>{{etl.date | date:"d. M. y H:mm:ss"}}</td>
				<td>{{targets[etl.target]}}</td>
				<td>{{etl.year}}</td>
				<td>{{etl.file}}</td>
				<td>{{statuses[etl.status]}}</td>
				<td><span *ngIf="etl.warnings.length">{{etl.warnings.length}} varování!</span></td>
			</tr>
			<tr>
				<td colspan="7" class="details">
					<div [class.visible]="etlVisible === etl._id">
						<dl>
							<dt>Nahrál uživatel</dt>
							<dd [title]="'Organizace: ' + etl.user?.organization + ', ID: ' + etl.user?._id">{{etl.user?.name}}</dd>
							
							<dt>Výsledek</dt>
							<dd>{{etl.result || etl.error}}</dd>

							<ng-container *ngIf="etl.warnings.length">
								<dt>Varování</dt>
								<dd>
									<ul>
										<li *ngFor="let warning of etl.warnings">{{warning}}</li>
									</ul>
								</dd>
							</ng-container>

						</dl>
					</div>
				</td>
			</tr>
		</ng-container>
</table>

